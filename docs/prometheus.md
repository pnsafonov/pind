# Метрики prometheus

По умолчанию prometheus сервер запускается на адресе 0.0.0.0:9091.    
Например http://192.168.3.31:9091/metrics

## Описание метрик

`pind_pool_idle_load0` - загрузка IDLE (коммуналка) ядер в процентах. Значения: 100%, 200%, 800%...   
Максимальное значение = (число ядер в IDLE) * 100 %.   

В графане:
```
# для всех хостов
pind_pool_idle_load0

# для micronode15
pind_pool_idle_load0{instance="micronode15:9091", job="pind"}
```

`pind_pool_idle_load1` - тоже самое, что и `pind_pool_idle_load0` только максимум 100%.

`pind_pool_load_free0` - загрузка свободных ядер выделенных под нагрузку (под привязку).   
По этому значению можно оценить фоновую, паразитную нагрузку, которая мешает, крадёт процессорное время.   
Значения: 100%, 200%, 800%...

`pind_pool_load_free1` - тоже самое, что и `pind_pool_load_free0` только максимум 100%.

`pind_pool_load_used0` - загрузка ядер к которым привязаны виртуальные машины.   
Значения: 100%, 200%, 800%...

`pind_pool_load_used1` - тоже самое, что и `pind_pool_load_used0` только максимум 100%.

`pind_procs_count` - число процессов (число виртуальных мащин), состояние которых отслеживает
pind и делает привзку к ядрам

### Метрики NUMA node

`pind_node_load_free0` -  загрузка свободных ядер выделенных под нагрузку (под привязку) определённой NUMA ноды.      
По этому значению можно оценить фоновую, паразитную нагрузку, которая мешает, крадёт процессорное время.   
Значения: 100%, 200%, 800%...

В графане:
```
# все сервера, все numa ноды
pind_node_load_free0

# numa node 0 сервера micronode15
pind_node_load_free0{instance="micronode15:9091", job="pind", node="0"}

# numa node 1 сервера micronode15
pind_node_load_free0{instance="micronode15:9091", job="pind", node="0"}
```

`pind_node_load_free1` - тоже самое, что и `pind_node_load_free0` только максимум 100%.

`pind_node_load_used0` -  загрузка ядер к которым привязаны виртуальные машины определённой NUMA ноды.      
Значения: 100%, 200%, 800%...

`pind_node_load_used1` - тоже самое, что и `pind_node_load_used0` только максимум 100%.

`pind_node_load_free_count` - число неиспользуемых ядер NUMA ноды.    
Целые числа.

`pind_node_load_used_count` - число используемых ядер NUMA ноды.   
Целые числа.

### Метрики виртуалных машин

`pind_vm_cpu` - потребление процессорного времени виртуальной машиной.   
Значения: 100%, 200%, 800%...

В графане:
```
# по всем хостам, по всем виртуальным машинам
pind_vm_cpu

# хост mn15, имя виртуалки ps-va-16-1-db
pind_vm_cpu{instance="micronode15:9091", job="pind", vm_name="ps-va-16-1-db"}
```

`pind_vm_load` - находится ли виртуальная машина под нагрузкой (значение 1) и нужно
ли её привязывать. Если привязывать не нужно то значение 0.

`pind_vm_numa` - индекс NUMA ноды к которой привязана виртуалка. Если нагрузки нет, 
то виртуалка остаётся в коммуналке и имеет значение -1. Если нагрузка есть, то
принимает значение индекса NUMA ноды.

`pind_vm_required_cores_phys` - требуемое число физических ядер процессора из пула,
выделенного под нагрузку (pool_load).

`pind_vm_required_cores` - требуемое число ядер (с учётом логических) процессора.

`pind_vm_assigned_cores` - число фактически назначенных логических ядер процессора.

`pind_vm_assigned_cores0` - процент назначенных (привязанных) ядер процессора.   
Максимум 100% - всё назначилось, ядер хватило.
