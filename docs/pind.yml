---
# Настройки логгера
log:
  # Уровень логирования:
  # debug, info, warning, error.
  level: info
  # Включение файлового логгера.
  # Логгер поддержит ротацию файлов.
  rotator_enabled: true
  # Настройки ротатора логов.
  rotator:
    # Путь куда будет сохранён лог файл
    file_name: /var/log/pind/pind.log
    # Максимальный размер файла MiB.
    max_size: 10
    # Число лог файлов.
    max_backups: 5
    # Максимальный возраст в днях перед ротацией файла.
    max_age: 28
    # Локальное время в лог файлах.
    locale_time: true
  # Влючение логгирования в stderr, перенаправляется в journald.
  # Команда чтения логов:
  # journalctl -u pind
  stderr_enabled: true
# Настройки логики сервиса
service:
  # Интервал времени в мс.
  # Рабочий цикл совершается периодически в интервал времени.
  interval: 1000
  # Порог потребления ядер процессора,
  # выше которого процесс считвается нагруженным.
  # 150 % - 1,5 ядра
  threshold: 150
  # Первый фильтр
  # Фильтрует процессы по имени.
  # Кто попадает в фильтр 1,
  # но не попадает в фильтр 2 прикрепляется к IDLE-ядрам.
  filters0:
    # Группа паттернов
    # Любая группа паттернов должна совпасть полностью для попадания в фильтр
    - type: name
      patterns:
        # Все текстовые паттерны должны совпасть в имени процесса, аргументах
        - /usr/bin/kvm
  # Второй фильтр
  filters1:
    # Группа паттернов
    - type: name
      patterns:
        # Все текстовые паттерны должны совпасть в имени процесса, аргументах
        - /usr/bin/kvm
  # Списки ядер процессора
  pool:
    # Ядра для IDLE
    idle: 0-11
    # Ядра для процессов,
    # которые потребляют выше порога в 150 %.
    load: 12-95
    # Допускается и такая запись
    # load: 4-23,48-71

  # Выбор потока в процессе,
  # которому будут назначено отдельное ядро (selected_cores_count).
  # Если поток не попал под фильтр, то
  # процесс делит общие ядра с числом (not_selected_cores_count),
  # выделенные на данный процесс.
  selection:
    type: single
    patterns:
      # Все текстовые паттерны должны совпать с Comm потока (процесса)
      # Comm - второй слобец в /proc/{pid}/stat
      - CPU
      - /KVM

  # Поток, который следует игнорировать и не привязывать к ядрам.
  # Оставить, так как есть.
  ignore:
    type: name
    patterns:
      # Все текстовые паттерны должны совпать с Comm потока (процесса)
      - iou-wrk-

  # Алгоритм распределения ядер для процесса
  pin_cores_algo:
    type: single
    # 1 уникальное ядро на поток, выбранный через selection
    selected_cores_count: 1
    # 2 на ВСЕ потоки, которые не попали под selection
    not_selected_cores_count: 2